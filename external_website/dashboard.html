<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./css/formcss.css">
    <!--https://codepen.io/mican/pen/dRWxZe-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="./js/dashboard/request.js"></script>
    <script src="./js/dashboard/generate_types.js"></script>
    <script src="./js/dashboard/generate_freezers.js"></script>
    <title>Dashboard</title>
</head>

<body>
    <form method="POST" name="get_token" action="javascript:void(0);" onsubmit="setToken()">
        <p>
            <label>token
                <input type="text" name="token">
            </label>
        </p>
        <input class="button" type="submit" name="submit">
    </form>
    <p id="token_error"></p>
    <h2>Possible types</h2>
    <div id="types_table" style="overflow:auto; height:400px;">
    </div>

    <div>
        <h2>Freezers</h2>
        <div id="freezers_table" style="overflow:auto; height:400px;"></div>
        <p>Add a freezer</p>
        <form method="POST" name="add_freezer" class="form" action="javascript:void(0);" onsubmit="addFreezer('add_freezer')">
            <p class='field required'>
                <label class='label'>name
                    <input type="text" name="name" required>
                </label>
            </p>
            <p class='field required'>
                <label class='label'>num_boxes
                    <input type="text" name="num_boxes" required>
                </label>
            </p>
            <input class="button" type="submit" name="submit">
        </form>
    </div>
    <div id= "tmp">
    </div>

</body>
<script>
    var token = "";
    var domainUrl = "http://localhost:5000/";
    var typesObject = {};
    var freezersObject = {};

    function setToken() {
        token = document.forms["get_token"]["token"].value;
        check_token();
    }

    function clear_dashboard() {
        document.getElementById("token_error").innerHTML = "";
        document.getElementById("types_table").innerHTML = "";
        document.getElementById("freezers_table").innerHTML = "";
    }

    function check_token() {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                clear_dashboard();
                setDashboard();
            } else {
                clear_dashboard();
                document.getElementById("token_error").innerHTML = "the token given is not valid";
            }
            // need to manage other types exception
        };
        xmlhttp.open("GET", "http://localhost:5000/check_token/" + token, true);
        xmlhttp.send();
    }

    function createRadioButton(group, val, text){
        return '<input type="radio" name="' + group + '" value="' + val + '">' + text + '<br>';
    }

    function test() {
        var f = document.createElement("form");
        f.setAttribute('method', 'POST');
        f.setAttribute('action', 'javascript:void(0);');

        var params = ['all', 'inside', 'outside'];
        var grp1 = "";
        var grp2 = "";

        for (var i = 0; i < params.length; i++) {
            grp1 += createRadioButton("group1", params[i],params[i]);
        }

        //f.innerHTML = grp1;

        grp2 += createRadioButton("group2", 0, "all freezers");

        console.log(freezersObject.content);
        console.log(freezersObject.content.length);
        for (var i = 0; i < freezersObject.content.length; i++) {
            grp2 += createRadioButton("group2", freezersObject.content[i]['freezer_id'], freezersObject.content[i]['freezer_name']);
        }

        f.innerHTML = grp1 + grp2;
        // TODO ajouter le bouton submit
        document.getElementById('tmp').appendChild(f);
    }

    function setDashboard() {
        typesObject = { type: "GET", url: domainUrl + "types/" + token, elementId: "types_table" };
        freezersObject = { type: "GET", url: domainUrl + "freezers/" + token, elementId: "freezers_table", cascadeCallback: true, callback: test };
        ajaxRequest(typesObject, generateTableFromJson);
        ajaxRequest(freezersObject, generateTableFromJson);
        console.log(freezersObject);
        //console.log(freezersObject.type);
    }
</script>

</html>